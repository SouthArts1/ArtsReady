<div class="grid_12">
  <hgroup>
    <h1><%= @page.title rescue 'Page Not Found'%></h1>
  </hgroup>
</div>

<div class="grid_12">
  <%= @page.to_html rescue "No page found"%>
</div>

<div class="grid_12">
	
	<% if @organization.errors.any? %>
  <div class="error_messages">
      <h2>Form is invalid</h2>
      <ul>
        <% for message in @organization.errors.full_messages %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

	<% form_for @payment, :url => "/billing" do |f| %>
		<%= f.hidden_field :organization_id, value: @organization.id %>
		<%= f.hidden_field :discount_code_id, value: @payment.discount_code_id %>
		<%= f.label :billing_first_name %><br />
		<%= f.text_field :billing_first_name %><br />
		<%= f.label :billing_last_name %><br />
		<%= f.text_field :billing_last_name %><br />
		<%= f.label :billing_address %><br />
		<%= f.text_field :billing_address %><br />
		<%= f.label :billing_city %><br />
		<%= f.text_field :billing_city %><br />
		<%= f.label :billing_state %><br />
		<%= f.text_field :billing_state %><br />
		<%= f.label :billing_zipcode %><br />
		<%= f.text_field :billing_zipcode %><br />
		<br />
		Payment information:
		<p style="padding: 8px 12px; background: #dfd; color: #151; display: block; margin: 10px 0px; width: 600px; font-size: 13px; line-height: 15px; border-left: 3px solid #ada;">
			This information will not be saved.<br /> 
			Each subscription will be processed individually on its given timeline.<br />
			You may use a Credit/Debit Card for processing, or your checking or savings account.
		</p><br /><br />
		<p style="padding: 8px 12px; background: #dfd; color: #151; display: block; margin: 10px 0px; width: 600px; font-size: 13px; line-height: 15px; border-left: 3px solid #ada;">
			By entering your payment information, you agree to be billed <strong id="starting_value"><%= money_from_cents @payment.starting_amount_in_cents %></strong> for the first year of service, and <strong id="ending_value"><%= money_from_cents @payment.regular_amount_in_cents %></strong> annually for consecutive years (prices including discounts).
		</p>
		<p>Have a discount code? <input type="text" id="discount_code" style="width:200px;" />
			<br /><input type="button" id="discount_submit" value="Use my discount code!" /></p>
		</script>
		<table style="border:none;">
			<tr>
				<td>
					<p>
						Please choose your payment type: 
						<select id="payment_type" name="payment_type">
							<option value="blank"></option>
							<option value="cc">Credit Card</option>
							<option value="bank">Bank Account</option>
						</select>
					</p>
				</td>
			</tr>
		</table>
		<br />
		<div id="cc_info" style="display:none;">
			<table style="border:none;">
				<tr>
					<td><p>Credit Card Number:</p></td>
					<td><p><%= f.text_field :number %></p></td>
				</tr>
				<tr>
					<td><p>Expiration Date:</p></td>
					<td><p><%= f.date_select :expiry_month, :order => [:month] %> <%= f.date_select :expiry_year, :order => [:year] %></p></td></td>
				</tr>
				<tr>
					<td><p>Verification Number (CVV2):</p></td>
					<td><p><%= f.text_field :ccv %></p></td>
				</tr>
			</table>
			<br />
		</div>
		<div id="bank_info" style="display:none;">
			<table style="border:none;">
				<tr>
					<td><p>Bank Name:</p></td>
					<td><p><%= f.text_field :bank_name %></p></td>
				</tr>
				<tr>
					<td><p>Account Type:</p></td>
					<td><p><%= f.select :account_type, ["Checking", "Savings"] %></p></td>
				</tr>
				<tr>
					<td><p>ABA Routing Number:</p></td>
					<td><p><%= f.text_field :routing_number %></p></td>
				</tr>
				<tr>
					<td><p>Account Number:</p></td>
					<td><p><%= f.text_field :account_number %></p></td>
				</tr>
			</table>
		</div>
		<br />
		<%= f.submit %>
	<script type="text/javascript">
		$.fn.animateHighlight = function(highlightColor, duration) {
		    var highlightBg = highlightColor || "#FFFF9C";
		    var animateMs = duration || 1500;
		    var originalBg = this.css("backgroundColor");
		    this.stop().css("background-color", highlightBg).animate({backgroundColor: originalBg}, animateMs);
		};
		
		$(document).ready(function() {
			$("#discount_submit").click(function() {
				window.location.href = ("/billing/new/"+ $("#discount_code").val())
			})
				
			$("#payment_billing_first_name").animateHighlight("#dd0000", 2000);
			$("#payment_billing_last_name").animateHighlight("#dd0000", 2000);
			
			$("#payment_type").change(function() {
				var type = "#" + $("#payment_type").val() + "_info";
				$("#cc_info").slideUp();
				$("#bank_info").slideUp();

				$(type).slideDown();
			});
		})
	</script>
	<% end %>
</div>